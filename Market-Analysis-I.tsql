/* Write your T-SQL query statement below */

select distinct user_id as buyer_id, join_date, sum(order_count) over(partition by user_id) as orders_in_2019 from(select *, 
case 
when order_id is not null then 1
else 0 
end as order_count from
(select u.user_id, u.join_date, z.* from users as u left join
(select t.*, items.item_brand from (select * from orders where datepart(year, order_date) = 2019) as t
inner join items on items.item_id = t.item_id) as z on u.user_id = z.buyer_id) as b) as a 